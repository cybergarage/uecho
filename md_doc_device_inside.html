<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>uEcho for C: Inside of uEcho Device</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">uEcho for C
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_doc_device_inside.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Inside of uEcho Device </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >A <a href="http://echonet.jp/english/">ECHONET Lite</a> node includes the objects, and the objects can be classified into two types: profile objects and device objects. The profile object is standard profile information such as the operation status, manufacturer information, and device object list. The device object is a logical model of the information or of control items that can be remotely controlled.</p>
<p ><img src="img/device_objects.png" alt="Device Objects" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md13"></a>
Node Profile Object</h1>
<p >The node profile object is a standard profile object, <a href="http://echonet.jp/english/">ECHONET Lite</a> node must have the following mandatory profile class object which has all children objects of the node <a href="http://www.echonet.gr.jp/english/spec/index.htm">[1]</a>.</p>
<ul>
<li>Class group code: 0x0E</li>
<li>Class code: 0xF0</li>
<li>Instance code: 0x01 (general node)</li>
</ul>
<p >The <code>uecho</code> updates the node profile class objects automatically when the children objects in the node are changed, and so the developer doesn't need to update the node profile object yourself.</p>
<h1><a class="anchor" id="autotoc_md14"></a>
Device Object Super Class</h1>
<p ><a href="http://echonet.jp/english/">ECHONETLite</a> device node must have some mandatory properties <a href="http://www.echonet.gr.jp/english/spec/index.htm">[2]</a>. The <code><a class="el" href="device_8c.html#a02dded630518cf2ab02b7e6413308136">uecho_device_new()</a></code> addes the following mandatory properties into the device object as default, and the developer should update the properties according to the device status.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">EPC   </th><th class="markdownTableHeadNone">Property name   </th><th class="markdownTableHeadNone">Default value    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x80   </td><td class="markdownTableBodyNone">Operation status   </td><td class="markdownTableBodyNone">0x30 = ON    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x81   </td><td class="markdownTableBodyNone">Installation location   </td><td class="markdownTableBodyNone">0x00    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x82   </td><td class="markdownTableBodyNone">Standard version information   </td><td class="markdownTableBodyNone">Appendix F    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x88   </td><td class="markdownTableBodyNone">Fault status   </td><td class="markdownTableBodyNone">0x42 = No fault has occurred    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x8A   </td><td class="markdownTableBodyNone">Manufacturer code   </td><td class="markdownTableBodyNone">0xFFFFF0 = Testing code   </td></tr>
</table>
<p >The <code>uecho</code> add the following mandatory properties too. However, the developer doesn't need to update the mandatory properties because the <code>uecho</code> updates the mandatory properties automatically when any properties are added or removed.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">EPC   </th><th class="markdownTableHeadNone">Property name    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x9D   </td><td class="markdownTableBodyNone">Status change announcement property map    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x9E   </td><td class="markdownTableBodyNone">Set property map    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x9F   </td><td class="markdownTableBodyNone">Get property map   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md15"></a>
Device Message Handler and Listener</h1>
<p >The <code>uecho</code> handles all request messages from other nodes automatically, the developer need only control request message permissions from other nodes and controllers to the target object properties using the object property handlers of the <code>uecho</code>. However, the developer can set some request message listeners into the node and objects to listen the raw messages of <a href="http://echonet.jp/english/">ECHONET Lite</a> too. The following figure shows the message handling sequence of <code>uecho</code>.</p>
<p ><img src="img/node_msg_handler.png" alt="Node Observers" class="inline"/></p>
<p >The request message listeners of the node and object can listen all request messages, but the object property handlers receives only valid request messages.</p>
<h2><a class="anchor" id="autotoc_md16"></a>
Property Message Handler</h2>
<p >The <code><a class="el" href="object_8c.html#a08efa74bf1a6dd8fb8ef5b81d4de6c12">uecho_object_setpropertyrequesthandler()</a></code> can set the following permission handler to an object property to handle valid request messages from other nodes.</p>
<div class="fragment"><div class="line">typedef bool (*uEchoPropertyRequestHandler)(uEchoObject*, uEchoProperty*, uEchoEsv, size_t, byte *);</div>
</div><!-- fragment --><p >The developer handles the request messages from other nodes. The developer should return a true if the request message is valid, otherwise false. In addition, the developer does not need to update the target property data by the request property data because the <code>uecho</code> updates the target property by the request property data automatically when the handler returns true. The following example shows to check a write request message and set the valid property data to the target property.</p>
<div class="fragment"><div class="line">bool object_property_handler(uEchoObject* obj, uEchoProperty* prop, uEchoEsv esv, size_t pdc, byte *edt)</div>
<div class="line">{</div>
<div class="line">  if (pdc != 1)</div>
<div class="line">    return false;</div>
<div class="line">  return true;</div>
<div class="line">}</div>
</div><!-- fragment --><p >The <code><a class="el" href="object_8c.html#a08efa74bf1a6dd8fb8ef5b81d4de6c12">uecho_object_setpropertyrequesthandler()</a></code> sets the permission handlers each ESV (ECHONET Lite Service) of <a href="http://echonet.jp/english/">ECHONET Lite</a>. Terefore <code>uecho</code> offers the following sugar fuctions to set the permission handlers more easily for the read and write request messages.</p>
<ul>
<li>uecho_object_setpropertyreadrequesthandler()</li>
<li><a class="el" href="object_8c.html#af58c5117790f80da5c2dc6f306433708">uecho_object_setpropertywriterequesthandler()</a></li>
</ul>
<p >The <code>uecho</code> handles the read and notification request messages automatically. Threfore, the developer can create a device of <a href="http://echonet.jp/english/">ECHONET Lite</a> only to handle write message requests using the <code><a class="el" href="object_8c.html#af58c5117790f80da5c2dc6f306433708">uecho_object_setpropertywriterequesthandler()</a></code>.</p>
<h2><a class="anchor" id="autotoc_md17"></a>
Node Message Listener</h2>
<p >The <code><a class="el" href="node_8c.html#a49c7994d1b5eb05ba4a0ac39d41aecbc">uecho_node_setmessagelistener()</a></code> can set the following listener to get all message for the node from other nodes, thus the message might be invalid.</p>
<div class="fragment"><div class="line">typedef void (*uEchoNodeMessageListener)(uEchoNode*, uEchoMessage*);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md18"></a>
Object Message Listener</h2>
<p >The <code><a class="el" href="object_8c.html#aae6114456b8331a3bbaf87f0e97cafa3">uecho_object_setmessagelistener()</a></code> can set the following listener to get only valid messages for the object from other nodes.</p>
<div class="fragment"><div class="line">typedef void (*uEchoObjectMessageListener)(uEchoObject*, uEchoMessage*);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md19"></a>
Supported Basic Sequences</h1>
<p >The <code>uecho</code> supports the following five basic sequences in ECHONET Lite Communication Middleware Specification <a href="http://www.echonet.gr.jp/english/spec/index.htm">[1]</a>.</p>
<h2><a class="anchor" id="autotoc_md20"></a>
4.2.1 Basic Sequences for Service Content</h2>
<p >The <code>uecho</code> handles the five basic sequences automatically, thus the developer doesn't have to implement the responses directly. The property data is announced automatically when the property is changed using <code><a class="el" href="property_8c.html#ae92d7da6aafe9481d6332ae1a110b52b">uecho_property_setdata()</a></code>.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Support    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">(A)   </td><td class="markdownTableBodyNone">Basic sequence for receiving a request (no response required)   </td><td class="markdownTableBodyNone">O    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">(B)   </td><td class="markdownTableBodyNone">Basic sequence for receiving a request (response required)   </td><td class="markdownTableBodyNone">O    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">(C)   </td><td class="markdownTableBodyNone">Basic sequence for processing a notification request   </td><td class="markdownTableBodyNone">O    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">(D)   </td><td class="markdownTableBodyNone">Basic sequence for autonomous notification   </td><td class="markdownTableBodyNone">O    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">(E)   </td><td class="markdownTableBodyNone">Basic sequence for processing a request requiring a notification response   </td><td class="markdownTableBodyNone">O   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md21"></a>
4.2.2 Basic Sequences for Object Control in General</h2>
<p >The <code>uecho</code> supports the following basic sequences too, and returns the error responses automatically. The developer doesn't have to receive and handle the error messages, but use <code><a class="el" href="node_8c.html#a49c7994d1b5eb05ba4a0ac39d41aecbc">uecho_node_setmessagelistener()</a></code> if you want to listen the error messages.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Support    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">(A)   </td><td class="markdownTableBodyNone">Processing when the controlled object does not exist   </td><td class="markdownTableBodyNone">O    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">(B)   </td><td class="markdownTableBodyNone">Processing when the controlled object exists, except when ESV = 0x60 to 0x63, 0x6E and 0x74   </td><td class="markdownTableBodyNone">O    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">(C)   </td><td class="markdownTableBodyNone">Processing when the controlled object exists but the controlled property does not exist or can be processed only partially   </td><td class="markdownTableBodyNone">O    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">(D)   </td><td class="markdownTableBodyNone">Processing when the controlled property exists but the stipulated service processing functions are not available   </td><td class="markdownTableBodyNone">O    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">(E)   </td><td class="markdownTableBodyNone">Processing when the controlled property exists and the stipulated service processing functions are available but the EDT size does not match   </td><td class="markdownTableBodyNone">O   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md22"></a>
References</h1>
<ul>
<li>[1] <a href="http://www.echonet.gr.jp/english/spec/index.htm">Part II ECHONET Lite Communication Middleware Specification</a></li>
<li>[2] <a href="http://www.echonet.gr.jp/english/spec/index.htm">Detailed Requirements for ECHONET Device objects</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
